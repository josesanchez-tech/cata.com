<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DataRD â€” Datos Abiertos RepÃºblica Dominicana</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Bebas+Neue&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root{
  --ink:#0d0c0b; --paper:#f5f2ed; --cream:#ede8e0; --warm:#d9d1c3;
  --rust:#c0390a; --rust2:#e8450c; --rust3:#ff6b3d;
  --blue:#0f4c81; --teal:#0a6b68; --gold:#b87d00; --green:#1a6b3a; --purple:#5b2d8e;
  --card:#ffffff; --border:#cdc5b8; --text:#1a1816; --muted:#7a7166; --light:#a09890;
  --shadow:0 2px 16px rgba(0,0,0,.08);
  --r:10px;
}

*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{background:var(--paper);color:var(--text);font-family:'Space Grotesk',sans-serif;min-height:100vh;
  background-image:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23c0a080' fill-opacity='0.06'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
}

/* â”€â”€ HEADER â”€â”€ */
.site-header{
  background:var(--ink);
  padding:0 0 0 0;
  position:relative;
  overflow:hidden;
}
.header-inner{
  max-width:1400px;margin:0 auto;
  display:grid;grid-template-columns:1fr auto;align-items:stretch;
  padding:0 40px;
}
.header-left{padding:48px 0 40px;}
.logo-line{display:flex;align-items:center;gap:14px;margin-bottom:6px;}
.logo-text{font-family:'Bebas Neue',sans-serif;font-size:3.2rem;color:white;letter-spacing:.02em;line-height:1;}
.logo-flag{font-size:2rem;line-height:1;}
.logo-sub{font-size:.72rem;font-family:'JetBrains Mono',monospace;color:rgba(255,255,255,.4);
  letter-spacing:.18em;text-transform:uppercase;margin-bottom:24px;}
.header-tagline{font-size:.95rem;color:rgba(255,255,255,.6);font-weight:300;max-width:440px;line-height:1.6;}
.header-right{
  display:flex;flex-direction:column;justify-content:center;align-items:flex-end;
  padding:40px 0;gap:10px;
}
.stat-pill{
  background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.12);
  border-radius:40px;padding:10px 20px;text-align:right;
}
.stat-pill .n{font-family:'Bebas Neue',sans-serif;font-size:1.8rem;color:var(--rust3);letter-spacing:.02em;}
.stat-pill .l{font-size:.67rem;color:rgba(255,255,255,.45);font-family:'JetBrains Mono',monospace;
  text-transform:uppercase;letter-spacing:.12em;display:block;margin-top:-3px;}
.header-stripe{height:4px;background:linear-gradient(90deg,var(--rust) 0%,var(--rust3) 40%,var(--gold) 70%,var(--teal) 100%);}

/* â”€â”€ MEGA SEARCH â”€â”€ */
.search-zone{
  background:var(--ink);
  padding:0 40px 44px;
}
.search-zone-inner{max-width:1400px;margin:0 auto;}
.search-label{font-size:.68rem;font-family:'JetBrains Mono',monospace;color:rgba(255,255,255,.4);
  letter-spacing:.18em;text-transform:uppercase;margin-bottom:10px;}
.search-wrap{
  display:grid;grid-template-columns:1fr auto;gap:0;
  border:1px solid rgba(255,255,255,.18);border-radius:var(--r);overflow:hidden;
  background:rgba(255,255,255,.06);transition:border-color .2s;
}
.search-wrap:focus-within{border-color:var(--rust3);}
.search-type-sel{
  background:transparent;border:none;border-right:1px solid rgba(255,255,255,.12);
  color:rgba(255,255,255,.7);font-family:'JetBrains Mono',monospace;font-size:.76rem;
  padding:0 16px;cursor:pointer;outline:none;min-width:130px;
  -webkit-appearance:none;
}
.search-type-sel option{background:#1a1816;color:white;}
.search-input{
  flex:1;background:transparent;border:none;color:white;font-family:'Space Grotesk',sans-serif;
  font-size:1.1rem;padding:18px 20px;outline:none;width:100%;
}
.search-input::placeholder{color:rgba(255,255,255,.28);}
.search-btn{
  background:var(--rust);border:none;color:white;font-family:'Bebas Neue',sans-serif;
  font-size:1.1rem;letter-spacing:.05em;padding:0 32px;cursor:pointer;transition:background .2s;
  white-space:nowrap;
}
.search-btn:hover{background:var(--rust2);}
.search-chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;}
.chip{
  font-size:.67rem;font-family:'JetBrains Mono',monospace;padding:4px 12px;border-radius:20px;
  border:1px solid rgba(255,255,255,.15);color:rgba(255,255,255,.45);cursor:pointer;
  transition:all .15s;
}
.chip:hover,.chip.on{border-color:var(--rust3);color:var(--rust3);}

/* â”€â”€ RESULTS BAR â”€â”€ */
.results-bar{
  background:white;border-bottom:2px solid var(--cream);
  padding:14px 40px;display:flex;align-items:center;gap:16px;flex-wrap:wrap;
}
.results-bar-inner{max-width:1400px;margin:0 auto;width:100%;display:flex;align-items:center;gap:16px;flex-wrap:wrap;}
.results-label{font-size:.8rem;color:var(--muted);}
.results-label strong{color:var(--text);}
.source-filter{display:flex;gap:6px;flex-wrap:wrap;margin-left:auto;}
.sf{
  font-size:.7rem;font-family:'JetBrains Mono',monospace;padding:5px 12px;border-radius:6px;
  border:1px solid var(--border);background:var(--cream);cursor:pointer;color:var(--muted);transition:all .15s;
}
.sf:hover{border-color:var(--rust);color:var(--rust);}
.sf.active{background:var(--rust);color:white;border-color:var(--rust);}

/* â”€â”€ LAYOUT â”€â”€ */
.page-body{max-width:1400px;margin:0 auto;padding:32px 40px 80px;display:grid;
  grid-template-columns:300px 1fr;gap:28px;}

/* â”€â”€ SIDEBAR â”€â”€ */
.sidebar{}
.sidebar-card{
  background:var(--card);border:1px solid var(--border);border-radius:var(--r);
  overflow:hidden;margin-bottom:16px;
}
.sidebar-head{
  padding:14px 18px;border-bottom:1px solid var(--cream);
  font-size:.68rem;font-family:'JetBrains Mono',monospace;font-weight:600;
  color:var(--muted);text-transform:uppercase;letter-spacing:.12em;
}
.api-item{
  padding:14px 18px;border-bottom:1px solid var(--cream);cursor:pointer;
  transition:background .15s;display:flex;align-items:center;gap:12px;
}
.api-item:last-child{border-bottom:none;}
.api-item:hover{background:var(--paper);}
.api-item.active{background:#fff8f5;border-left:3px solid var(--rust);}
.api-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
.api-item-info h4{font-size:.83rem;font-weight:600;color:var(--text);margin-bottom:2px;}
.api-item-info p{font-size:.68rem;color:var(--muted);font-family:'JetBrains Mono',monospace;}
.api-badge{font-size:.58rem;font-family:'JetBrains Mono',monospace;padding:2px 7px;border-radius:4px;
  font-weight:600;margin-top:4px;display:inline-block;}
.ab-live{background:rgba(26,107,58,.12);color:var(--green);}
.ab-key{background:rgba(11,76,129,.1);color:var(--blue);}

.info-box{padding:16px 18px;}
.info-box h4{font-size:.78rem;font-weight:600;margin-bottom:8px;}
.info-box p{font-size:.73rem;color:var(--muted);line-height:1.6;}

/* â”€â”€ MAIN CONTENT â”€â”€ */
.main-content{}
.welcome-state{
  background:var(--card);border:1px solid var(--border);border-radius:var(--r);
  padding:60px 40px;text-align:center;
}
.welcome-state .big-icon{font-size:3.5rem;margin-bottom:16px;}
.welcome-state h2{font-family:'Bebas Neue',sans-serif;font-size:2.2rem;letter-spacing:.03em;margin-bottom:10px;}
.welcome-state p{color:var(--muted);font-size:.9rem;max-width:440px;margin:0 auto 28px;line-height:1.7;}
.example-searches{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;}
.ex-btn{
  background:var(--cream);border:1px solid var(--border);border-radius:6px;
  padding:8px 16px;font-size:.78rem;cursor:pointer;transition:all .15s;font-family:'Space Grotesk',sans-serif;
}
.ex-btn:hover{background:var(--rust);color:white;border-color:var(--rust);}

.results-grid{}
.source-section{margin-bottom:28px;}
.source-title{
  display:flex;align-items:center;gap:10px;margin-bottom:12px;padding-bottom:10px;
  border-bottom:1px solid var(--border);
}
.source-title .st-dot{width:10px;height:10px;border-radius:50%;}
.source-title h3{font-family:'Bebas Neue',sans-serif;font-size:1.25rem;letter-spacing:.03em;}
.source-title .st-count{font-family:'JetBrains Mono',monospace;font-size:.7rem;color:var(--muted);margin-left:auto;}
.source-title .st-url{font-family:'JetBrains Mono',monospace;font-size:.65rem;color:var(--light);
  background:var(--cream);border:1px solid var(--border);padding:3px 9px;border-radius:4px;}

/* Result cards */
.result-card{
  background:var(--card);border:1px solid var(--border);border-radius:var(--r);
  padding:20px 22px;margin-bottom:10px;position:relative;overflow:hidden;
  transition:box-shadow .2s,transform .2s;
}
.result-card::before{
  content:'';position:absolute;top:0;left:0;width:3px;height:100%;
  background:var(--card-accent,var(--rust));
}
.result-card:hover{box-shadow:var(--shadow);transform:translateY(-1px);}
.rc-header{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin-bottom:10px;}
.rc-name{font-size:1rem;font-weight:600;color:var(--text);flex:1;}
.rc-name mark{background:#fff3cd;color:var(--text);border-radius:3px;padding:0 2px;}
.rc-badges{display:flex;flex-wrap:wrap;gap:5px;flex-shrink:0;}
.badge{font-size:.63rem;font-family:'JetBrains Mono',monospace;padding:3px 9px;border-radius:5px;
  border:1px solid;font-weight:600;}
.b-active{background:rgba(26,107,58,.08);color:var(--green);border-color:rgba(26,107,58,.25);}
.b-inactive{background:rgba(192,57,10,.08);color:var(--rust);border-color:rgba(192,57,10,.25);}
.b-pending{background:rgba(184,125,0,.1);color:var(--gold);border-color:rgba(184,125,0,.25);}
.b-neutral{background:rgba(0,0,0,.05);color:var(--muted);border-color:var(--border);}
.rc-meta{display:flex;flex-wrap:wrap;gap:6px 20px;margin-bottom:10px;}
.rc-meta-item{font-size:.72rem;color:var(--muted);display:flex;align-items:center;gap:5px;}
.rc-meta-item strong{color:var(--text);font-weight:500;}
.rc-meta-item .mi-icon{font-size:.8rem;}
.rc-actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;padding-top:10px;border-top:1px solid var(--cream);}
.rc-btn{
  font-size:.7rem;font-family:'JetBrains Mono',monospace;padding:5px 13px;
  border-radius:6px;border:1px solid var(--border);background:var(--paper);cursor:pointer;
  color:var(--muted);transition:all .15s;text-decoration:none;display:inline-flex;align-items:center;gap:4px;
}
.rc-btn:hover{background:var(--rust);color:white;border-color:var(--rust);}
.rc-btn.primary{background:var(--rust);color:white;border-color:var(--rust);}
.rc-btn.primary:hover{background:var(--rust2);}
.rc-source-tag{font-size:.6rem;font-family:'JetBrains Mono',monospace;color:var(--light);
  position:absolute;top:14px;right:16px;opacity:.6;}

/* Expandable detail */
.rc-detail{display:none;margin-top:12px;border-top:1px solid var(--cream);padding-top:12px;}
.rc-detail.open{display:block;}
.detail-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:10px;}
.detail-cell{background:var(--paper);border-radius:6px;padding:10px 12px;}
.detail-cell .dc-label{font-size:.6rem;font-family:'JetBrains Mono',monospace;color:var(--light);
  text-transform:uppercase;letter-spacing:.1em;margin-bottom:4px;}
.detail-cell .dc-val{font-size:.8rem;color:var(--text);font-weight:500;word-break:break-all;}
.detail-list{margin-top:10px;}
.detail-list-item{background:var(--paper);border-radius:6px;padding:10px 14px;margin-bottom:6px;
  display:flex;justify-content:space-between;align-items:center;gap:12px;}
.detail-list-item .di-main{font-size:.8rem;font-weight:500;}
.detail-list-item .di-sub{font-size:.7rem;color:var(--muted);}
.detail-list-item .di-amount{font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--green);
  font-weight:600;flex-shrink:0;}

/* Loading */
.loading{text-align:center;padding:48px 20px;}
.spinner{width:32px;height:32px;border:3px solid var(--cream);border-top-color:var(--rust);
  border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 14px;}
@keyframes spin{to{transform:rotate(360deg);}}
.loading p{font-size:.82rem;color:var(--muted);font-family:'JetBrains Mono',monospace;}

/* Error */
.error-box{background:#fff5f5;border:1px solid #fcc;border-radius:var(--r);
  padding:20px 22px;color:#c00;font-size:.83rem;}

/* Empty */
.empty-state{text-align:center;padding:60px 20px;color:var(--muted);}
.empty-state .ei{font-size:2.5rem;margin-bottom:12px;}
.empty-state h3{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;margin-bottom:6px;color:var(--text);}
.empty-state p{font-size:.83rem;line-height:1.6;}

/* API INFO CARDS (when nothing searched) */
.api-showcase{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px;}
.api-card{
  background:var(--card);border:1px solid var(--border);border-radius:var(--r);
  padding:22px;position:relative;overflow:hidden;transition:all .2s;
}
.api-card::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;background:var(--ac,#999);}
.api-card:hover{transform:translateY(-2px);box-shadow:var(--shadow);}
.ac-icon{font-size:1.8rem;margin-bottom:10px;}
.ac-title{font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:.03em;margin-bottom:4px;}
.ac-org{font-size:.7rem;color:var(--muted);font-style:italic;margin-bottom:10px;}
.ac-desc{font-size:.76rem;color:var(--muted);line-height:1.6;margin-bottom:12px;}
.ac-fields{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:14px;}
.ac-field{font-size:.62rem;font-family:'JetBrains Mono',monospace;padding:2px 8px;
  border-radius:4px;background:var(--cream);border:1px solid var(--border);color:var(--muted);}
.ac-status{font-size:.62rem;font-family:'JetBrains Mono',monospace;font-weight:700;
  padding:3px 9px;border-radius:4px;}
.ac-live{background:rgba(26,107,58,.1);color:var(--green);}
.ac-url{font-family:'JetBrains Mono',monospace;font-size:.62rem;color:var(--light);
  margin-top:8px;word-break:break-all;}

/* Pagination */
.pagination{display:flex;justify-content:center;gap:8px;margin-top:24px;}
.pg-btn{width:36px;height:36px;border-radius:6px;border:1px solid var(--border);
  background:var(--card);cursor:pointer;font-size:.8rem;transition:all .15s;font-family:'JetBrains Mono',monospace;}
.pg-btn:hover{background:var(--rust);color:white;border-color:var(--rust);}
.pg-btn.cur{background:var(--rust);color:white;border-color:var(--rust);}

/* Toast */
.toast{position:fixed;bottom:28px;right:28px;background:var(--ink);color:white;
  border-radius:8px;padding:12px 20px;font-size:.8rem;z-index:1000;
  transform:translateY(80px);opacity:0;transition:all .3s;}
.toast.show{transform:translateY(0);opacity:1;}

/* Scrollbar */
::-webkit-scrollbar{width:6px;}
::-webkit-scrollbar-track{background:var(--cream);}
::-webkit-scrollbar-thumb{background:var(--warm);border-radius:3px;}

@media(max-width:900px){
  .header-inner,.page-body{grid-template-columns:1fr;}
  .header-right{display:none;}
  .page-body{padding:20px 16px;}
  .search-zone,.results-bar{padding-left:16px;padding-right:16px;}
  .header-left{padding:32px 0 28px;}
  .header-inner{padding:0 20px;}
  .search-zone{padding:0 16px 28px;}
}
</style>
</head>
<body>

<!-- HEADER -->
<div class="site-header">
  <div class="header-inner">
    <div class="header-left">
      <div class="logo-line">
        <span class="logo-flag">ğŸ‡©ğŸ‡´</span>
        <span class="logo-text">DataRD</span>
      </div>
      <div class="logo-sub">Hub de Datos Abiertos Â· RepÃºblica Dominicana</div>
      <p class="header-tagline">Acceso unificado a los datos pÃºblicos del Estado Dominicano â€” proveedores, contratos, sentencias, patrimonio, finanzas y mÃ¡s.</p>
    </div>
    <div class="header-right">
      <div class="stat-pill"><span class="n">8</span><span class="l">APIs conectadas</span></div>
      <div class="stat-pill"><span class="n">123K+</span><span class="l">Proveedores</span></div>
      <div class="stat-pill"><span class="n">1,175</span><span class="l">Datasets abiertos</span></div>
    </div>
  </div>
</div>
<div class="header-stripe"></div>

<!-- MEGA SEARCH -->
<div class="search-zone">
  <div class="search-zone-inner">
    <div class="search-label">Buscar en todas las fuentes de datos</div>
    <div class="search-wrap">
      <select class="search-type-sel" id="searchType">
        <option value="empresa">ğŸ¢ Empresa / RNC</option>
        <option value="cedula">ğŸ‘¤ CÃ©dula</option>
        <option value="rpe">ğŸ”– RPE</option>
      </select>
      <input class="search-input" id="searchInput" placeholder="Nombre de empresa, RNC o nÃºmero identificadorâ€¦" autocomplete="off" />
      <button class="search-btn" onclick="runSearch()">BUSCAR</button>
    </div>
    <div class="search-chips">
      <span class="chip on" id="chip-dgcp" onclick="toggleSource('dgcp',this)">DGCP Proveedores</span>
      <span class="chip on" id="chip-contratos" onclick="toggleSource('contratos',this)">DGCP Contratos</span>
      <span class="chip on" id="chip-resoluciones" onclick="toggleSource('resoluciones',this)">Resoluciones DGCP</span>
      <span class="chip on" id="chip-sentencias" onclick="toggleSource('sentencias',this)">Sentencias SCJ</span>
      <span class="chip on" id="chip-audiencias" onclick="toggleSource('audiencias',this)">Audiencias</span>
      <span class="chip on" id="chip-patrimonio" onclick="toggleSource('patrimonio',this)">Patrimonio</span>
      <span class="chip" id="chip-sb" onclick="toggleSource('sb',this)">SB Financiero</span>
    </div>
  </div>
</div>

<!-- RESULTS BAR (hidden by default) -->
<div class="results-bar" id="resultsBar" style="display:none;">
  <div class="results-bar-inner">
    <span class="results-label" id="resultsLabel">â€“</span>
    <div class="source-filter" id="sourceFilter"></div>
  </div>
</div>

<!-- BODY -->
<div class="page-body">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-card">
      <div class="sidebar-head">ğŸ”Œ Fuentes Conectadas</div>
      <div class="api-item active" onclick="setApiInfo('dgcp')">
        <div class="api-dot" style="background:#c0390a"></div>
        <div class="api-item-info">
          <h4>DGCP Proveedores</h4>
          <p>datosabiertos.dgcp.gob.do</p>
          <span class="api-badge ab-live">âœ“ PÃºblica</span>
        </div>
      </div>
      <div class="api-item" onclick="setApiInfo('contratos')">
        <div class="api-dot" style="background:#e8450c"></div>
        <div class="api-item-info">
          <h4>DGCP Contratos</h4>
          <p>datosabiertos.dgcp.gob.do</p>
          <span class="api-badge ab-live">âœ“ PÃºblica</span>
        </div>
      </div>
      <div class="api-item" onclick="setApiInfo('resoluciones')">
        <div class="api-dot" style="background:#b87d00"></div>
        <div class="api-item-info">
          <h4>Resoluciones DGCP</h4>
          <p>civiceye-production.up.railway.app</p>
          <span class="api-badge ab-live">âœ“ PÃºblica</span>
        </div>
      </div>
      <div class="api-item" onclick="setApiInfo('sentencias')">
        <div class="api-dot" style="background:#0a6b68"></div>
        <div class="api-item-info">
          <h4>Sentencias SCJ</h4>
          <p>civiceye-production.up.railway.app</p>
          <span class="api-badge ab-live">âœ“ PÃºblica</span>
        </div>
      </div>
      <div class="api-item" onclick="setApiInfo('audiencias')">
        <div class="api-dot" style="background:#5b2d8e"></div>
        <div class="api-item-info">
          <h4>Audiencias Judiciales</h4>
          <p>civiceye-production.up.railway.app</p>
          <span class="api-badge ab-live">âœ“ PÃºblica</span>
        </div>
      </div>
      <div class="api-item" onclick="setApiInfo('patrimonio')">
        <div class="api-dot" style="background:#1a6b3a"></div>
        <div class="api-item-info">
          <h4>Patrimonio Funcionarios</h4>
          <p>civiceye-production.up.railway.app</p>
          <span class="api-badge ab-live">âœ“ PÃºblica</span>
        </div>
      </div>
      <div class="api-item" onclick="setApiInfo('bcrd')">
        <div class="api-dot" style="background:#0f4c81"></div>
        <div class="api-item-info">
          <h4>BCRD Indicadores</h4>
          <p>bancentral.gov.do</p>
          <span class="api-badge ab-live">âœ“ PÃºblica</span>
        </div>
      </div>
      <div class="api-item" onclick="setApiInfo('sb')">
        <div class="api-dot" style="background:#374151"></div>
        <div class="api-item-info">
          <h4>Superintendencia Bancos</h4>
          <p>desarrollador.sb.gob.do</p>
          <span class="api-badge ab-key">ğŸ”‘ Requiere clave</span>
        </div>
      </div>
    </div>

    <div class="sidebar-card" id="apiInfoBox">
      <div class="sidebar-head">â„¹ï¸ Sobre esta API</div>
      <div class="info-box">
        <h4 id="ai-title">DGCP Proveedores</h4>
        <p id="ai-desc" style="margin-bottom:10px">Base de datos completa de proveedores del Estado registrados en el SNCC. Permite bÃºsqueda por nombre de razÃ³n social, RNC y RPE.</p>
        <p style="font-size:.68rem;font-family:'JetBrains Mono',monospace;color:var(--light)" id="ai-url">datosabiertos.dgcp.gob.do/api-dgcp/v1</p>
      </div>
    </div>

    <div class="sidebar-card">
      <div class="sidebar-head">ğŸ“¥ Descargar Datos</div>
      <div class="info-box">
        <p style="margin-bottom:10px">Portal oficial con +1,175 datasets en CSV, XLS y ODS.</p>
        <a href="https://datos.gob.do" target="_blank" class="rc-btn primary" style="display:inline-flex;text-decoration:none">â†’ datos.gob.do</a>
      </div>
    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="main-content" id="mainContent">
    <div class="welcome-state" id="welcomeState">
      <div class="big-icon">ğŸ›ï¸</div>
      <h2>Busca en los Datos Abiertos del Estado</h2>
      <p>Consulta simultÃ¡neamente proveedores, contratos, sentencias, patrimonio de funcionarios y mÃ¡s. Selecciona las fuentes arriba y escribe tu bÃºsqueda.</p>
      <div class="example-searches">
        <button class="ex-btn" onclick="doExample('constructora')">ğŸ—ï¸ Constructora</button>
        <button class="ex-btn" onclick="doExample('farmacÃ©utica')">ğŸ’Š FarmacÃ©utica</button>
        <button class="ex-btn" onclick="doExample('tecnologÃ­a')">ğŸ’» TecnologÃ­a</button>
        <button class="ex-btn" onclick="doExample('transporte')">ğŸš› Transporte</button>
        <button class="ex-btn" onclick="doExample('consulting')">ğŸ“Š Consulting</button>
      </div>
      <div style="margin-top:40px;border-top:1px solid var(--border);padding-top:32px;">
        <p style="font-size:.75rem;color:var(--muted);margin-bottom:18px;font-family:'JetBrains Mono',monospace;text-transform:uppercase;letter-spacing:.1em;">APIs disponibles</p>
        <div class="api-showcase" id="apiShowcase"></div>
      </div>
    </div>
    <div id="resultsContainer" style="display:none;"></div>
  </main>
</div>

<div class="toast" id="toast"></div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const activeSources = new Set(['dgcp','contratos','resoluciones','sentencias','audiencias','patrimonio']);
let lastQuery = '';

const API_INFO = {
  dgcp:{
    title:'DGCP Proveedores',color:'#c0390a',icon:'ğŸ¢',
    desc:'Base de datos de proveedores del Estado registrados en el Sistema Nacional de Compras y Contrataciones PÃºblicas. +123,000 empresas y personas.',
    url:'datosabiertos.dgcp.gob.do/api-dgcp/v1/proveedores',
    fields:['RazÃ³n Social','RNC','RPE','Estado','MIPYME'],
    status:'live'
  },
  contratos:{
    title:'DGCP Contratos',color:'#e8450c',icon:'ğŸ“‹',
    desc:'Contratos adjudicados en procesos de compras del Estado. Incluye montos, instituciones contratantes, modalidades y fechas.',
    url:'datosabiertos.dgcp.gob.do/api-dgcp/v1/contratos',
    fields:['Proveedor','Monto','InstituciÃ³n','Modalidad','Fecha'],
    status:'live'
  },
  resoluciones:{
    title:'Resoluciones DGCP',color:'#b87d00',icon:'ğŸ“„',
    desc:'Resoluciones emitidas por el ente rector de contrataciones pÃºblicas relacionadas con proveedores y procesos.',
    url:'civiceye-production.up.railway.app/companies',
    fields:['Tipo','NÃºmero','Fecha','DescripciÃ³n'],
    status:'live'
  },
  sentencias:{
    title:'Sentencias SCJ',color:'#0a6b68',icon:'âš–ï¸',
    desc:'Sentencias de la Suprema Corte de Justicia donde aparece la empresa o persona como parte.',
    url:'civiceye-production.up.railway.app/judicial-cases',
    fields:['Expediente','Sala','Fecha','Tipo'],
    status:'live'
  },
  audiencias:{
    title:'Audiencias Judiciales',color:'#5b2d8e',icon:'ğŸ””',
    desc:'Audiencias programadas o celebradas en el Poder Judicial donde participa la entidad buscada.',
    url:'civiceye-production.up.railway.app/judicial_power',
    fields:['Tribunal','Materia','Fecha','Estado'],
    status:'live'
  },
  patrimonio:{
    title:'Patrimonio Funcionarios',color:'#1a6b3a',icon:'ğŸ‘¤',
    desc:'Declaraciones juradas de patrimonio de funcionarios pÃºblicos registradas ante la DIGEIG.',
    url:'civiceye-production.up.railway.app/patrimony_summary',
    fields:['Nombre','Cargo','InstituciÃ³n','AÃ±o'],
    status:'live'
  },
  bcrd:{
    title:'BCRD Indicadores',color:'#0f4c81',icon:'ğŸ“ˆ',
    desc:'API del Banco Central con indicadores macroeconÃ³micos: PIB, inflaciÃ³n, tipo de cambio, tasa de interÃ©s y mÃ¡s.',
    url:'apibcrd.bancentral.gov.do',
    fields:['PIB','InflaciÃ³n','Tipo cambio','Tasas'],
    status:'live'
  },
  sb:{
    title:'Superintendencia de Bancos',color:'#374151',icon:'ğŸ¦',
    desc:'Datos del sistema financiero: bancarizaciÃ³n, cartera de crÃ©dito, indicadores por entidad. Requiere registro en el portal de desarrolladores.',
    url:'desarrollador.sb.gob.do',
    fields:['BancarizaciÃ³n','Cartera','Solvencia','Captaciones'],
    status:'key'
  }
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// RENDER SHOWCASE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderShowcase() {
  const el = document.getElementById('apiShowcase');
  el.innerHTML = Object.entries(API_INFO).map(([key,a])=>`
    <div class="api-card" style="--ac:${a.color}">
      <div class="ac-icon">${a.icon}</div>
      <div class="ac-title">${a.title}</div>
      <div class="ac-org">${a.url.split('/')[0]}</div>
      <div class="ac-desc">${a.desc}</div>
      <div class="ac-fields">${a.fields.map(f=>`<span class="ac-field">${f}</span>`).join('')}</div>
      <span class="ac-status ${a.status==='live'?'ac-live':''}">
        ${a.status==='live'?'âœ“ API PÃºblica':'ğŸ”‘ Requiere clave'}
      </span>
    </div>
  `).join('');
}
renderShowcase();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TOGGLE SOURCE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleSource(src, el) {
  if (activeSources.has(src)) { activeSources.delete(src); el.classList.remove('on'); }
  else { activeSources.add(src); el.classList.add('on'); }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// API INFO SIDEBAR
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setApiInfo(key) {
  const a = API_INFO[key];
  document.querySelectorAll('.api-item').forEach(el=>el.classList.remove('active'));
  event.currentTarget.classList.add('active');
  document.getElementById('ai-title').textContent = a.title;
  document.getElementById('ai-desc').textContent = a.desc;
  document.getElementById('ai-url').textContent = a.url;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// KEYBOARD
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('searchInput').addEventListener('keydown', e => {
  if (e.key === 'Enter') runSearch();
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// EXAMPLES
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function doExample(q) {
  document.getElementById('searchInput').value = q;
  runSearch();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MAIN SEARCH
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function runSearch() {
  const q = document.getElementById('searchInput').value.trim();
  if (!q) return showToast('Escribe algo para buscar');
  if (activeSources.size === 0) return showToast('Activa al menos una fuente');
  lastQuery = q;

  document.getElementById('welcomeState').style.display = 'none';
  document.getElementById('resultsContainer').style.display = 'block';
  document.getElementById('resultsBar').style.display = 'flex';

  const container = document.getElementById('resultsContainer');
  container.innerHTML = `<div class="loading"><div class="spinner"></div><p>Consultando ${activeSources.size} fuentesâ€¦</p></div>`;

  const promises = [];
  if (activeSources.has('dgcp')) promises.push(fetchDGCP(q));
  if (activeSources.has('contratos')) promises.push(fetchContratos(q));
  if (activeSources.has('resoluciones')) promises.push(fetchResoluciones(q));
  if (activeSources.has('sentencias')) promises.push(fetchSentencias(q));
  if (activeSources.has('audiencias')) promises.push(fetchAudiencias(q));
  if (activeSources.has('patrimonio')) promises.push(fetchPatrimonio(q));

  const results = await Promise.allSettled(promises);
  renderResults(results, q);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FETCH FUNCTIONS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CE = 'https://civiceye-production.up.railway.app';

async function fetchDGCP(q) {
  const r = await fetch(`${CE}/companies?company=${encodeURIComponent(q)}`);
  if (!r.ok) throw new Error('HTTP ' + r.status);
  const data = await r.json();
  const list = Array.isArray(data) ? data : (data.data || data.results || []);
  return {source:'dgcp', items: list.slice(0,30) };
}

async function fetchContratos(q) {
  // Search contratos via CivicEye using company search then get contracts per RPE
  const r = await fetch(`${CE}/companies?company=${encodeURIComponent(q)}`);
  if (!r.ok) throw new Error('HTTP ' + r.status);
  const data = await r.json();
  const companies = Array.isArray(data) ? data : (data.data||[]);
  if (!companies.length) return {source:'contratos', items:[]};
  // fetch contracts for first few companies
  const rpe = companies[0]?.rpe;
  if (!rpe) return {source:'contratos', items:[]};
  const r2 = await fetch(`${CE}/contracts/${rpe}`);
  if (!r2.ok) return {source:'contratos', items:[]};
  const d2 = await r2.json();
  const items = Array.isArray(d2) ? d2 : (d2.data||d2.results||[]);
  return {source:'contratos', items:items.slice(0,20), context:{company: companies[0]}};
}

async function fetchResoluciones(q) {
  const r = await fetch(`${CE}/companies?company=${encodeURIComponent(q)}`);
  if (!r.ok) throw new Error('HTTP ' + r.status);
  const data = await r.json();
  const companies = Array.isArray(data) ? data : (data.data||[]);
  if (!companies.length) return {source:'resoluciones', items:[]};
  const rpe = companies[0]?.rpe;
  if (!rpe) return {source:'resoluciones', items:[]};
  const r2 = await fetch(`${CE}/resolutions/${rpe}`);
  if (!r2.ok) return {source:'resoluciones', items:[]};
  const d2 = await r2.json();
  const items = Array.isArray(d2) ? d2 : (d2.data||d2.results||[]);
  return {source:'resoluciones', items:items.slice(0,15), context:{company: companies[0]}};
}

async function fetchSentencias(q) {
  const r = await fetch(`${CE}/companies?company=${encodeURIComponent(q)}`);
  if (!r.ok) throw new Error('HTTP ' + r.status);
  const data = await r.json();
  const companies = Array.isArray(data) ? data : (data.data||[]);
  if (!companies.length) return {source:'sentencias', items:[]};
  const rnc = companies[0]?.numero_documento || companies[0]?.rnc;
  if (!rnc) return {source:'sentencias', items:[]};
  const r2 = await fetch(`${CE}/judicial-cases?rnc=${rnc}`);
  if (!r2.ok) return {source:'sentencias', items:[]};
  const d2 = await r2.json();
  const items = Array.isArray(d2) ? d2 : (d2.data||d2.results||d2.cases||[]);
  return {source:'sentencias', items:items.slice(0,15)};
}

async function fetchAudiencias(q) {
  const r = await fetch(`${CE}/companies?company=${encodeURIComponent(q)}`);
  if (!r.ok) throw new Error('HTTP ' + r.status);
  const data = await r.json();
  const companies = Array.isArray(data) ? data : (data.data||[]);
  if (!companies.length) return {source:'audiencias', items:[]};
  const rnc = companies[0]?.numero_documento || companies[0]?.rnc;
  if (!rnc) return {source:'audiencias', items:[]};
  const r2 = await fetch(`${CE}/judicial_power?rnc=${rnc}`);
  if (!r2.ok) return {source:'audiencias', items:[]};
  const d2 = await r2.json();
  const items = Array.isArray(d2) ? d2 : (d2.data||d2.results||d2.hearings||[]);
  return {source:'audiencias', items:items.slice(0,15)};
}

async function fetchPatrimonio(q) {
  const r = await fetch(`${CE}/patrimony_summary?name=${encodeURIComponent(q)}`);
  if (!r.ok) throw new Error('HTTP ' + r.status);
  const data = await r.json();
  const items = Array.isArray(data) ? data : (data.data||data.results||[]);
  return {source:'patrimonio', items:items.slice(0,20)};
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// RENDER RESULTS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderResults(settled, q) {
  const container = document.getElementById('resultsContainer');
  container.innerHTML = '';
  let totalFound = 0;

  const sections = [];
  settled.forEach(s => {
    if (s.status === 'rejected') return;
    const {source, items, context} = s.value;
    if (!items || items.length === 0) return;
    totalFound += items.length;
    sections.push({source, items, context});
  });

  if (sections.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="ei">ğŸ”</div>
        <h3>Sin Resultados</h3>
        <p>No se encontraron resultados para "<strong>${q}</strong>" en las fuentes seleccionadas.<br>
        Intenta con otro tÃ©rmino o activa mÃ¡s fuentes.</p>
      </div>`;
    document.getElementById('resultsLabel').innerHTML = `Sin resultados para <strong>"${q}"</strong>`;
    return;
  }

  document.getElementById('resultsLabel').innerHTML = `<strong>${totalFound}</strong> resultado${totalFound!==1?'s':''} para <strong>"${q}"</strong>`;

  // Source filter buttons
  const sf = document.getElementById('sourceFilter');
  sf.innerHTML = sections.map(s=>`
    <button class="sf active" onclick="scrollToSection('sec-${s.source}', this)">
      ${API_INFO[s.source]?.icon||'ğŸ“Œ'} ${API_INFO[s.source]?.title||s.source} (${s.items.length})
    </button>
  `).join('');

  sections.forEach(({source, items, context}) => {
    const info = API_INFO[source] || {};
    const div = document.createElement('div');
    div.className = 'source-section';
    div.id = `sec-${source}`;
    div.innerHTML = `
      <div class="source-title">
        <div class="st-dot" style="background:${info.color||'#999'}"></div>
        <h3>${info.icon||''} ${info.title||source}</h3>
        <span class="st-url">${(info.url||'').split('/')[0]}</span>
        <span class="st-count">${items.length} resultado${items.length!==1?'s':''}</span>
      </div>
      ${source==='dgcp' ? renderDGCPResults(items,q) :
        source==='contratos' ? renderContratosResults(items,q,context) :
        source==='resoluciones' ? renderResolucionesResults(items,q) :
        source==='sentencias' ? renderSentenciasResults(items,q) :
        source==='audiencias' ? renderAudienciasResults(items,q) :
        source==='patrimonio' ? renderPatrimonioResults(items,q) :
        `<div class="error-box">Fuente sin renderizador</div>`
      }
    `;
    container.appendChild(div);
  });
}

function scrollToSection(id, btn) {
  const el = document.getElementById(id);
  if (el) el.scrollIntoView({behavior:'smooth',block:'start'});
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// RENDERERS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function hl(text, q) {
  if (!text || !q) return text||'';
  const re = new RegExp(`(${q.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')})`, 'gi');
  return String(text).replace(re, '<mark>$1</mark>');
}

function fmt(n) {
  if (!n) return 'â€”';
  const num = parseFloat(String(n).replace(/[^0-9.]/g,''));
  if (isNaN(num)) return n;
  return 'RD$ ' + num.toLocaleString('es-DO', {maximumFractionDigits:2});
}

function statusBadge(estado) {
  if (!estado) return '';
  const s = String(estado).toLowerCase();
  if (s.includes('activ')) return `<span class="badge b-active">ACTIVO</span>`;
  if (s.includes('inactiv') || s.includes('suspend') || s.includes('sancion')) return `<span class="badge b-inactive">${estado.toUpperCase()}</span>`;
  if (s.includes('pendiente') || s.includes('provisional')) return `<span class="badge b-pending">${estado.toUpperCase()}</span>`;
  return `<span class="badge b-neutral">${estado.toUpperCase()}</span>`;
}

// DGCP PROVIDERS
function renderDGCPResults(items, q) {
  return items.map((item,i) => {
    const nombre = item.razon_social || item.name || item.empresa || 'â€”';
    const rnc = item.numero_documento || item.rnc || 'â€”';
    const rpe = item.rpe || 'â€”';
    const estado = item.estado || '';
    const mipyme = item.provee || item.mipyme_type || '';
    return `
      <div class="result-card" style="--card-accent:${API_INFO.dgcp.color}">
        <span class="rc-source-tag">DGCP</span>
        <div class="rc-header">
          <div class="rc-name">${hl(nombre,q)}</div>
          <div class="rc-badges">${statusBadge(estado)}</div>
        </div>
        <div class="rc-meta">
          <span class="rc-meta-item"><span class="mi-icon">ğŸ”¢</span>RNC <strong>${rnc}</strong></span>
          <span class="rc-meta-item"><span class="mi-icon">ğŸ”–</span>RPE <strong>${rpe}</strong></span>
          ${mipyme?`<span class="rc-meta-item"><span class="mi-icon">ğŸ·ï¸</span>MIPYME <strong>${mipyme}</strong></span>`:''}
        </div>
        <div class="rc-actions">
          <button class="rc-btn primary" onclick="loadProfile('${rpe}','${rnc}',\`${nombre.replace(/`/g,"'")}\`)">Ver Perfil Completo â†’</button>
          <button class="rc-btn" onclick="searchContratos('${rpe}',\`${nombre.replace(/`/g,"'")}\`)">ğŸ“‹ Contratos</button>
          <button class="rc-btn" onclick="searchJudicial('${rnc}',\`${nombre.replace(/`/g,"'")}\`)">âš–ï¸ Judicial</button>
          <button class="rc-btn" onclick="copyText('${rnc}')">ğŸ“‹ Copiar RNC</button>
        </div>
      </div>
    `;
  }).join('');
}

// CONTRATOS
function renderContratosResults(items, q, context) {
  const company = context?.company?.razon_social || q;
  return `
    <div style="background:#fff8f0;border:1px solid #ffe0c0;border-radius:8px;padding:12px 16px;margin-bottom:10px;font-size:.78rem;color:var(--muted)">
      ğŸ“‹ Contratos para <strong>${company}</strong>
    </div>
    ${items.map(item => {
      const objeto = item.descripcion_proceso || item.objeto || item.nombre_proceso || item.proceso || 'â€”';
      const monto = item.monto || item.valor || item.importe || '';
      const institucion = item.institucion_contratante || item.entidad || item.ente || 'â€”';
      const modalidad = item.modalidad || item.tipo || '';
      const fecha = item.fecha_adjudicacion || item.fecha || '';
      return `
        <div class="result-card" style="--card-accent:${API_INFO.contratos.color}">
          <span class="rc-source-tag">CONTRATOS</span>
          <div class="rc-header">
            <div class="rc-name" style="font-size:.88rem">${hl(objeto,q)}</div>
            ${monto?`<div class="rc-badges"><span class="badge b-active">${fmt(monto)}</span></div>`:''}
          </div>
          <div class="rc-meta">
            ${institucion!='â€”'?`<span class="rc-meta-item"><span class="mi-icon">ğŸ›ï¸</span><strong>${hl(institucion,q)}</strong></span>`:''}
            ${modalidad?`<span class="rc-meta-item"><span class="mi-icon">ğŸ“Œ</span>${modalidad}</span>`:''}
            ${fecha?`<span class="rc-meta-item"><span class="mi-icon">ğŸ“…</span>${fecha}</span>`:''}
          </div>
        </div>
      `;
    }).join('')}
  `;
}

// RESOLUCIONES
function renderResolucionesResults(items, q) {
  return items.map(item => {
    const num = item.numero || item.number || item.id || 'â€”';
    const tipo = item.tipo || item.type || item.categoria || 'â€”';
    const desc = item.descripcion || item.resolucion || item.detalle || item.asunto || '';
    const fecha = item.fecha || item.date || '';
    return `
      <div class="result-card" style="--card-accent:${API_INFO.resoluciones.color}">
        <span class="rc-source-tag">RESOLUCIONES</span>
        <div class="rc-header">
          <div class="rc-name" style="font-size:.88rem">${hl(desc||`ResoluciÃ³n ${num}`,q)}</div>
          <div class="rc-badges"><span class="badge b-neutral">${tipo}</span></div>
        </div>
        <div class="rc-meta">
          ${num!='â€”'?`<span class="rc-meta-item"><span class="mi-icon">ğŸ”¢</span>NÂ° <strong>${num}</strong></span>`:''}
          ${fecha?`<span class="rc-meta-item"><span class="mi-icon">ğŸ“…</span>${fecha}</span>`:''}
        </div>
      </div>
    `;
  }).join('');
}

// SENTENCIAS
function renderSentenciasResults(items, q) {
  return items.map(item => {
    const exp = item.expediente || item.numero || item.id || 'â€”';
    const sala = item.sala || item.tribunal || item.court || 'â€”';
    const tipo = item.tipo || item.categoria || item.materia || '';
    const fecha = item.fecha || item.date || '';
    const estado = item.estado || item.status || '';
    return `
      <div class="result-card" style="--card-accent:${API_INFO.sentencias.color}">
        <span class="rc-source-tag">SCJ</span>
        <div class="rc-header">
          <div class="rc-name" style="font-size:.88rem">Expediente ${hl(exp,q)}</div>
          ${estado?`<div class="rc-badges">${statusBadge(estado)}</div>`:''}
        </div>
        <div class="rc-meta">
          <span class="rc-meta-item"><span class="mi-icon">ğŸ›ï¸</span><strong>${sala}</strong></span>
          ${tipo?`<span class="rc-meta-item"><span class="mi-icon">ğŸ“Œ</span>${tipo}</span>`:''}
          ${fecha?`<span class="rc-meta-item"><span class="mi-icon">ğŸ“…</span>${fecha}</span>`:''}
        </div>
      </div>
    `;
  }).join('');
}

// AUDIENCIAS
function renderAudienciasResults(items, q) {
  return items.map(item => {
    const tribunal = item.tribunal || item.court || item.juzgado || 'â€”';
    const materia = item.materia || item.tipo || item.categoria || 'â€”';
    const fecha = item.fecha || item.date || '';
    const hora = item.hora || item.time || '';
    const estado = item.estado || item.status || '';
    const partes = item.partes || item.parties || '';
    return `
      <div class="result-card" style="--card-accent:${API_INFO.audiencias.color}">
        <span class="rc-source-tag">AUDIENCIA</span>
        <div class="rc-header">
          <div class="rc-name" style="font-size:.88rem">${hl(tribunal,q)}</div>
          ${estado?`<div class="rc-badges">${statusBadge(estado)}</div>`:''}
        </div>
        <div class="rc-meta">
          <span class="rc-meta-item"><span class="mi-icon">ğŸ“Œ</span><strong>${materia}</strong></span>
          ${fecha?`<span class="rc-meta-item"><span class="mi-icon">ğŸ“…</span>${fecha} ${hora}</span>`:''}
          ${partes?`<span class="rc-meta-item"><span class="mi-icon">ğŸ‘¥</span>${String(partes).substring(0,60)}â€¦</span>`:''}
        </div>
      </div>
    `;
  }).join('');
}

// PATRIMONIO
function renderPatrimonioResults(items, q) {
  return items.map(item => {
    const nombre = item.nombre || item.name || item.funcionario || 'â€”';
    const cargo = item.cargo || item.puesto || item.position || 'â€”';
    const inst = item.institucion || item.entidad || item.organization || 'â€”';
    const aÃ±o = item.aÃ±o || item.year || item.periodo || '';
    const monto = item.monto_total || item.patrimonio || item.total || '';
    return `
      <div class="result-card" style="--card-accent:${API_INFO.patrimonio.color}">
        <span class="rc-source-tag">PATRIMONIO</span>
        <div class="rc-header">
          <div class="rc-name">${hl(nombre,q)}</div>
          ${monto?`<div class="rc-badges"><span class="badge b-neutral">${fmt(monto)}</span></div>`:''}
        </div>
        <div class="rc-meta">
          <span class="rc-meta-item"><span class="mi-icon">ğŸ’¼</span><strong>${cargo}</strong></span>
          <span class="rc-meta-item"><span class="mi-icon">ğŸ›ï¸</span>${inst}</span>
          ${aÃ±o?`<span class="rc-meta-item"><span class="mi-icon">ğŸ“…</span>${aÃ±o}</span>`:''}
        </div>
      </div>
    `;
  }).join('');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PROFILE LOADER (reuses existing logic)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadProfile(rpe, rnc, nombre) {
  const container = document.getElementById('resultsContainer');
  document.getElementById('welcomeState').style.display = 'none';
  container.style.display = 'block';
  container.innerHTML = `<div class="loading"><div class="spinner"></div><p>Cargando perfil de ${nombre}â€¦</p></div>`;
  document.getElementById('resultsBar').style.display = 'flex';
  document.getElementById('resultsLabel').innerHTML = `Perfil de <strong>${nombre}</strong>`;
  document.getElementById('sourceFilter').innerHTML = '';

  try {
    const [contractsRes, resolutionsRes, casesRes, hearingsRes] = await Promise.allSettled([
      fetch(`${CE}/contracts/${rpe}`).then(r=>r.json()),
      fetch(`${CE}/resolutions/${rpe}`).then(r=>r.json()),
      rnc ? fetch(`${CE}/judicial-cases?rnc=${rnc}`).then(r=>r.json()) : Promise.resolve([]),
      rnc ? fetch(`${CE}/judicial_power?rnc=${rnc}`).then(r=>r.json()) : Promise.resolve([]),
    ]);

    const contracts = contractsRes.status==='fulfilled'?(Array.isArray(contractsRes.value)?contractsRes.value:(contractsRes.value?.data||[])):[]; 
    const resolutions = resolutionsRes.status==='fulfilled'?(Array.isArray(resolutionsRes.value)?resolutionsRes.value:(resolutionsRes.value?.data||[])):[];
    const cases = casesRes.status==='fulfilled'?(Array.isArray(casesRes.value)?casesRes.value:(casesRes.value?.data||casesRes.value?.cases||[])):[];
    const hearings = hearingsRes.status==='fulfilled'?(Array.isArray(hearingsRes.value)?hearingsRes.value:(hearingsRes.value?.data||hearingsRes.value?.hearings||[])):[];

    const totalContracts = contracts.reduce((s,c)=>s+parseFloat(String(c.monto||c.valor||0).replace(/[^0-9.]/g,'')||0),0);

    container.innerHTML = `
      <div class="result-card" style="--card-accent:#c0390a;border-radius:12px;margin-bottom:20px;">
        <div style="display:flex;align-items:center;gap:16px;margin-bottom:16px;">
          <div style="width:56px;height:56px;background:#fff0ec;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;flex-shrink:0;">ğŸ¢</div>
          <div>
            <div style="font-family:'Bebas Neue',sans-serif;font-size:1.5rem;letter-spacing:.02em;line-height:1.2;">${nombre}</div>
            <div style="font-size:.75rem;color:var(--muted);font-family:'JetBrains Mono',monospace;margin-top:3px;">RNC: ${rnc} Â· RPE: ${rpe}</div>
          </div>
        </div>
        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px;">
          <div class="detail-cell"><div class="dc-label">Contratos</div><div class="dc-val" style="font-family:'Bebas Neue',sans-serif;font-size:1.5rem;">${contracts.length}</div></div>
          <div class="detail-cell"><div class="dc-label">Valor Total</div><div class="dc-val" style="font-size:.78rem;color:var(--green);font-weight:700;">${fmt(totalContracts)}</div></div>
          <div class="detail-cell"><div class="dc-label">Resoluciones</div><div class="dc-val" style="font-family:'Bebas Neue',sans-serif;font-size:1.5rem;">${resolutions.length}</div></div>
          <div class="detail-cell"><div class="dc-label">Casos SCJ</div><div class="dc-val" style="font-family:'Bebas Neue',sans-serif;font-size:1.5rem;">${cases.length}</div></div>
          <div class="detail-cell"><div class="dc-label">Audiencias</div><div class="dc-val" style="font-family:'Bebas Neue',sans-serif;font-size:1.5rem;">${hearings.length}</div></div>
        </div>
      </div>

      ${contracts.length?`
      <div class="source-section">
        <div class="source-title"><div class="st-dot" style="background:#e8450c"></div><h3>ğŸ“‹ Contratos</h3><span class="st-count">${contracts.length}</span></div>
        ${contracts.slice(0,10).map(c=>{
          const obj = c.descripcion_proceso||c.objeto||c.nombre_proceso||c.proceso||'Contrato';
          const monto = c.monto||c.valor||'';
          const ente = c.institucion_contratante||c.entidad||'';
          const fecha = c.fecha_adjudicacion||c.fecha||'';
          return `<div class="result-card" style="--card-accent:#e8450c">
            <div class="rc-name" style="font-size:.88rem;margin-bottom:8px;">${obj}</div>
            <div class="rc-meta">
              ${ente?`<span class="rc-meta-item">ğŸ›ï¸ <strong>${ente}</strong></span>`:''}
              ${monto?`<span class="rc-meta-item">ğŸ’° <strong style="color:var(--green)">${fmt(monto)}</strong></span>`:''}
              ${fecha?`<span class="rc-meta-item">ğŸ“… ${fecha}</span>`:''}
            </div>
          </div>`;
        }).join('')}
      </div>`:''}

      ${cases.length?`
      <div class="source-section">
        <div class="source-title"><div class="st-dot" style="background:#0a6b68"></div><h3>âš–ï¸ Sentencias SCJ</h3><span class="st-count">${cases.length}</span></div>
        ${renderSentenciasResults(cases.slice(0,8), nombre)}
      </div>`:''}

      ${hearings.length?`
      <div class="source-section">
        <div class="source-title"><div class="st-dot" style="background:#5b2d8e"></div><h3>ğŸ”” Audiencias</h3><span class="st-count">${hearings.length}</span></div>
        ${renderAudienciasResults(hearings.slice(0,8), nombre)}
      </div>`:''}

      <div class="rc-actions" style="margin-top:16px;">
        <button class="rc-btn" onclick="runSearch()">â† Volver a resultados</button>
        <a href="https://ojocivico.up.railway.app" target="_blank" class="rc-btn">ğŸ”— Ver en Ojo CÃ­vico</a>
      </div>
    `;
  } catch(e) {
    container.innerHTML = `<div class="error-box">Error cargando perfil: ${e.message}</div>`;
  }
}

async function searchContratos(rpe, nombre) {
  document.getElementById('searchInput').value = nombre;
  // directly show contracts
  const container = document.getElementById('resultsContainer');
  document.getElementById('welcomeState').style.display = 'none';
  container.style.display = 'block';
  container.innerHTML = `<div class="loading"><div class="spinner"></div><p>Cargando contratos de ${nombre}â€¦</p></div>`;
  try {
    const r = await fetch(`${CE}/contracts/${rpe}`);
    const data = await r.json();
    const items = Array.isArray(data) ? data : (data.data||[]);
    if (!items.length) { container.innerHTML = `<div class="empty-state"><div class="ei">ğŸ“‹</div><h3>Sin Contratos</h3><p>No se encontraron contratos registrados para ${nombre}.</p></div>`; return; }
    container.innerHTML = `<div class="source-section" id="sec-contratos">
      <div class="source-title"><div class="st-dot" style="background:#e8450c"></div><h3>ğŸ“‹ Contratos â€” ${nombre}</h3><span class="st-count">${items.length}</span></div>
      ${renderContratosResults(items, nombre, {company:{razon_social:nombre}})}
      <div class="rc-actions"><button class="rc-btn" onclick="runSearch()">â† Volver</button></div>
    </div>`;
  } catch(e) { container.innerHTML = `<div class="error-box">${e.message}</div>`; }
}

async function searchJudicial(rnc, nombre) {
  const container = document.getElementById('resultsContainer');
  document.getElementById('welcomeState').style.display = 'none';
  container.style.display = 'block';
  container.innerHTML = `<div class="loading"><div class="spinner"></div><p>Consultando expedientes judiciales de ${nombre}â€¦</p></div>`;
  try {
    const [casesR, hearingsR] = await Promise.allSettled([
      fetch(`${CE}/judicial-cases?rnc=${rnc}`).then(r=>r.json()),
      fetch(`${CE}/judicial_power?rnc=${rnc}`).then(r=>r.json()),
    ]);
    const cases = casesR.status==='fulfilled'?(Array.isArray(casesR.value)?casesR.value:(casesR.value?.data||casesR.value?.cases||[])):[];
    const hearings = hearingsR.status==='fulfilled'?(Array.isArray(hearingsR.value)?hearingsR.value:(hearingsR.value?.data||hearingsR.value?.hearings||[])):[];
    container.innerHTML = `
      ${cases.length?`<div class="source-section"><div class="source-title"><div class="st-dot" style="background:#0a6b68"></div><h3>âš–ï¸ Sentencias SCJ</h3><span class="st-count">${cases.length}</span></div>${renderSentenciasResults(cases,nombre)}</div>`:'<div class="empty-state" style="padding:30px"><p>Sin sentencias SCJ registradas.</p></div>'}
      ${hearings.length?`<div class="source-section"><div class="source-title"><div class="st-dot" style="background:#5b2d8e"></div><h3>ğŸ”” Audiencias</h3><span class="st-count">${hearings.length}</span></div>${renderAudienciasResults(hearings,nombre)}</div>`:'<div class="empty-state" style="padding:20px"><p>Sin audiencias registradas.</p></div>'}
      <div class="rc-actions"><button class="rc-btn" onclick="runSearch()">â† Volver</button></div>
    `;
  } catch(e) { container.innerHTML = `<div class="error-box">${e.message}</div>`; }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// UTILS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function copyText(txt) {
  navigator.clipboard.writeText(txt).then(()=>showToast('Copiado: ' + txt));
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), 2400);
}
</script>
</body>
</html>
